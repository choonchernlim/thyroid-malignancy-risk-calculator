var calculator=function(){var r=$(".brand-logo").attr("href"),t=$("#startOverBtn"),u=$("#calculateBtn"),v=$(".form"),h=$("#user-risk-text"),l=$("input:radio[name=user-risk-radio]"),w=$("input:radio[name=us-fna-radio]"),m=$("#calculator-input"),n=$("#calculator-result"),p=$("#computed-diagram"),x=$(".risk-info"),y=$("#malignancy-count-text"),z=$("#non-malignancy-count-text"),A=$("#result-probability"),B=$("#result-us-fna"),d=null,k=null,q=null,C=function(){var a=[];a.nonDiagnostic={estimate:.515,lower97ci:.336,
upper95ci:.791};a.benign={estimate:.093,lower97ci:.063,upper95ci:.139};a.aus={estimate:.405,lower97ci:.228,upper95ci:.719};a.suspiciousForFollicularNeoplasm={estimate:.608,lower97ci:.365,upper95ci:1.01};a.suspiciousForMalignancy={estimate:8.35,lower97ci:3.63,upper95ci:19.23};a.malignant={estimate:196.77,lower97ci:67.99,upper95ci:569.51};return{compute:function(e,b){var c=a[b],g=e/(1-e),f=g*c.estimate,d=g*c.lower97ci,c=g*c.upper95ci;return{preTestOdds:g,postTestOddsEstimate:f,postTestProbabilityEstimate:f/
(1+f)*100,postTestOddsLower:d,postTestProbabilityLower:d/(1+d)*100,postTestOddsHigher:c,postTestProbabilityHigher:c/(1+c)*100}}}}(),E=function(){$(window).bind("beforeunload",function(){v.trigger("reset")});h.focus(function(){l.prop("checked",!1)}).change(function(){var a=$(this).val(),e=!1,b=null;/^\d{1,3}$/.test(a)&&(b=parseInt(a),1<=b&&100>=b&&(e=!0));e?($(this).removeClass("invalid").addClass("valid"),d=b/100):($(this).removeClass("valid").addClass("invalid"),d=null)});l.change(function(){d=$(this).val();
h.val("")});w.change(function(){k=$(this).val();q=$(this).parent().find("label").text()});u.click(function(){var a=!0;null==d&&(a=!1,Materialize.toast("Valid probability required.",2500));null==k&&(a=!1,Materialize.toast("US-FNA result required.",2500));a&&D()});x.click(function(){var a=$(this);a.addClass("hide");a.parent().find(".risk-description").removeClass("hide")});n.addClass("hide");m.removeClass("hide")},D=function(){var a=0,e="",e=C.compute(d,k),b=Math.round(e.postTestProbabilityEstimate),
c=100-b;p.empty();for(var g=0;10>g;++g){var f=$('<div class="row center-align"  style="padding:0; margin: 0">');f.append('<div class="col s1" style="padding:0; margin: 0;">&nbsp;</div>');for(var h=0;10>h;++h)e=a++<b?"red-text":"teal-text",f.append('<div class="col s1"  style="padding: 0; margin: 0;"><i class="flow-text mdi-social-person '+e+'"></i></div>');f.append('<div class="col s1" style="padding:0; margin: 0;">&nbsp;</div>');p.append(f)}A.text(100*d);B.text(q);y.text((1==b?b+" patient":b+" patients")+
" with thyroid malignancy");z.text((1==c?c+" patient":c+" patients")+" without thyroid malignancy");t.click(function(){window.location=r});m.addClass("hide");n.removeClass("hide")};return{start:function(){E()}}}();calculator.start();
